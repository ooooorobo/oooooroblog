---
id: 56
title: Next.js 프로젝트에 구글 애널리틱스 붙이기
description: 코드 몇 줄 넣었더니 사용자 통계가 나온다!
tags: GA
date: 2022-11-27
---



import Aside from "../components/mdx/Aside"; import WavyLine from "../components/WavyLine";

> ※ 이 글은 2022년 8월 기준으로 작성되었습니다.

## 구글 애널리틱스에 프로젝트 추가하기

프로젝트의 GA 데이터를 관리하기 위한 관리자 계정을 추가하자.

[https://analytics.google.com/](https://analytics.google.com/) 의 관리 페이지로 들어가면 관리자 계정을 새로 만들 수 있다.

![계정 설정 페이지](/image/56/1-config-account.png)

간단한 정보를 입력하면 새 관리자 계정을 받을 수 있다.

![데이터 수집 시작하기](/image/56/2-start-collecting-data.png)

데이터를 수집하고 싶은 플랫폼을 선택한다. 이번에는 웹 블로그의 데이터를 수집할 것이므로 웹 플랫폼을 선택했다.

![데이터 스트림 설정](/image/56/3-set-data-stream.png)

웹 사이트의 URL과 스트림의 이름을 입력하고, 스트림을 생성한다.

<Aside>
    💡 **데이터 스트림**이란?<br/>
    GA는 웹사이트 뿐만 아니라 iOS, 안드로이드 어플리케이션의 트래픽 추적도 지원하고 있다. 동일한 서비스를 여러 플랫폼에서 제공하는 경우, 각 플랫폼마다 데이터 스트림을 가지게 된다.
</Aside>

![웹 스트림 세부정보](/image/56/4-detail-stream.png)

스트림을 생성하면 스트림 ID와 측정 ID를 받을 수 있다. 스트림을 방금 생성했으니, 당연히 웹사이트와 연결되어 있지 않아 경고 메시지가 표시된다. 메시지의 ‘태그 안내 보기' 버튼을 클릭하면, 웹사이트에 GA 태그를 설치하는 코드를 확인할 수 있다.

## 프로젝트에 Google 태그 설치하기

![Google 태그 설치](/image/56/5-install-ga-tag.png)

여기에 있는 스크립트 태그를 복사해서 그대로 head 태그의 마지막에 넣어 주면 된다.

<Aside>
    💡 **`head`와 `body` 중에 어디에 넣는게 더 좋을까?** <br/>
    참고:
    [https://www.analyticsmania.com/post/google-tag-manager-head-or-body/](https://www.analyticsmania.com/post/google-tag-manager-head-or-body/)<br/>
    <br/>
    위 블로그 포스트에 따르면, `body` 태그에 넣더라도 구글 태그 매니저는 정상 작동한다.<br/>
    `head` 태그에 넣으면 웹 사이트가 로드될 때 구글 태그 매니저가 같이 로드되기 때문에, 조금 더 빠르게 GTM을 실행시킬 수 있다는 장점이 있다. 하지만 페이지 로드 속도에 영향을 줄 수 있기 때문에,
    이 점을 고려해서 적절히 배치하면 된다.
</Aside>

Next.js 프로젝트이기 때문에, _document.tsx 파일의 Head 안에 GA 스크립트를 추가했다.
```tsx
<Html>
    <Head>
        ...
      {process.env.NODE_ENV === "production" && (
        <>
          <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-OOOOOOOO00"
          />
          <script
            dangerouslySetInnerHTML={{
              __html: `
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-OOOOOOOO00');
      `,
            }}
          />
        </>
      )}
    </Head>
    <body> ... </body>
</Html>
```

- GA에서 제공한 스크립트를 그대로 사용하기 위해 script 태그의 dangerouslySetInnerHTML 속성을 사용했다. 그렇지 않으면 lint나 타입 에러가 많이 발생해서 귀찮다.
- 환경 제한을 prod로 걸어주지 않으면 develop 환경의 데이터가 GA 데이터에 섞여 들어가는 문제가 있었다. 그래서 production 환경에서만 GA 스크립트를 넣어주도록 했다.

이렇게 스크립트 태그만 추가해주면 환경 설정은 끝! 나머지는 GA가 알아서 해준다.

## 디버깅

![구글 애널리틱스 디버거 크롬 확장 프로그램](/image/56/6-ga-debugger-extension.png)

GA 보고를 잘 보내고 있는지 궁금하다면, 구글 확장 프로그램 중 ‘Google Analytics Debugger’를 설치하면 된다.

![크롬 개발자 도구의 콘솔창](/image/56/7-ga-debugger-console.png)

크롬 확장 프로그램 설치 후, 디버거 아이콘을 클릭하면 아이콘에 ON 표시가 생긴다. 이때 개발자 도구의 console 탭을 열면 데이터 레이어에 push가 일어나는 것을 볼 수 있다.

## 데이터 살펴보기

![데이터 실시간 개요](/image/56/9-realtime-overview.png)

실시간 개요를 보면, 정말 실시간으로 데이터가 들어오고 있다. 코드 몇 줄 심었을 뿐인데 사용자가 어느 페이지에 들어갔는지, 접속 지역이 어딘지, 접속 기기가 뭔지도 알려준다.

다만 완전 정확하진 않은 것 같다. 캡쳐 당시 화성에서 꽤 떨어진 곳에 있었는데.. ^.^

![데이터 스냅샷](/image/56/8-report-snapshot.png)
![engagement overview](/image/56/10-engagement-overview.png)

이 블로그에는 8월 쯤에 GA를 달아 주었고, 현재 기준 이런 데이터가 쌓여 있다. 사용자가 어떤 페이지에 몇 분 동안 머물렀는지, 스크롤, 클릭같은 이벤트가 얼마나 일어났는지와 같은 데이터도 수집된다.

<WavyLine size={8}/>

- 설치가 정말 간단해서 앞으로도 프로젝트를 하게되면 GA부터 추가할 것 같다. 데이터가 쌓이는 걸 보는게 꽤 재밌다.
- 블로그를 오픈한 지 꽤 됐는데도 아직 지표가 저조하다 ㅜ.ㅜ 아무래도 검색에 블로그 글이 잘 걸리지 않는 게 가장 큰 문제인 것 같아서, SEO 개선을 위해 나름 여러가지 노력을 해봤다. 다음 글에서는 Next.js에서 SEO 개선을 위해 시도해 볼 수 있는 것들을 소개하려고 한다.

