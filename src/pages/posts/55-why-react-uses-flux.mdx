import PostUtil from "../../utils/postUtil";
import PostLayout from "../../components/post/PostLayout";

리액트 애플리케이션 상태를 관리하기 위해 단방향 데이터 플로우(Unidirectional data flow)를 주로 사용한다. 이를 위해 Flux 패턴을 구현한 상태 관리 라이브러리를 사용한다.

[Flux](https://github.com/facebook/flux)는 페이스북에서 개발한 클라이언트 사이드 웹 애플리케이션을 위한 아키텍처이자 상태 관리 라이브러리다. 그러나 Flux의 컨셉을 구현한 다른 괜찮은 상태 관리 라이브러리가 많이 등장하면서, Flux는 상태 관리 라이브러리보다는 앱 아키텍처로 여겨지게 됐다.
(flux 조차도 다른 라이브러리를 사용할 것을 권장하고 있다)

## Flux 컨셉

![flux 패턴 다이어그램](/image/55/flux-pattern.png)

1. 뷰(리액트 컴포넌트)에서 이벤트가 발생하면, 액션이 생성된다.
2. 액션은 Dispatcher에게 전달된다.
3. Dispatcher는 적절한 reducer를 통해 액션에 정의된 작업을 수행한다.
4. Reducer의 작업으로 인해 Store가 가지고 있는 상태가 갱신된다.
5. Store의 상태가 갱신되었음을 뷰에 전파하고, 뷰는 상태에 맞게 다시 렌더링된다.

그림의 화살표 방향처럼, 데이터는 한 방향을 향해서만 흘러간다. 뷰는 직접 Store를 변경할 수 없고, 액션은 직접 뷰를 변경할 수 없다.

## 어떻게 한 방향으로만 흐를 수 있을까?

Flux 패턴의 등장 객체(?)들은 모두 불변 객체 혹은 순수 함수이다.

- Store → 불변 객체로 관리된다
- Action → 불변 객체로 관리된다
- Dispatcher → 리듀서는 순수 함수이다
- Component → 단방향으로 데이터가 흘러오게 되어 있다. 컴포넌트가 변경되는 것은 prop과 state가 변경되는 순간 뿐이다

따라서 이 객체들이 가지고 있는 값은 함부로 변경이 불가능하고, 미리 약속한 방법대로만 변경 가능하다.

1. Store가 가지고 있는 상태 값을 변경하려면, Action 객체를 Dispatcher에게 넘겨줘 Reducer를 통해 변경해야 한다.
2. Component가 그리는 UI를 변경하려면, 컴포넌트에 넘겨주는 prop이나 컴포넌트가 가진 state를 변경해줘야 한다.

## 왜 한 방향으로 흐를까?

### 예측 가능성

컴포넌트는 prop과 state가 변하는 순간에 다시 렌더링된다. 만약 그렇지 않고 컴포넌트를 자유롭게 조작할 수 있었다면, 컴포넌트가 어떤 순간에 어떻게 변할지 예측하기 어려울 것이고, 이것은 사이드 이펙트를 낳는다. state도 마찬가지다. 컴포넌트가 어떻게 변할지 예측하기 위해서는 state가 어떤 상황에 어떻게 변경될지 예측 가능해야 한다.

불변 객체로 관리된다는 것은, 예상치 못한 곳에서 임의로 객체의 값을 수정할 수 없다는 것이다. Store를 변경하는 것이 허락된 곳에서만 값을 수정할 수 있기 때문에, Store의 변경은 예측 가능해지고, 값의 변경을 추적하기가 편리하다.

### 단순성

Flux 패턴 이전에 주로 사용되던 웹 아키텍처는 MVC 패턴이었다. MVC는 양방향 데이터 플로우(bi-directional data flow)를 따른다.

- scalable하지 않다
- 앱이 커질수록 복잡해지고, 이해하기 힘들다
- 유지보수하기 힘들다
- 테스트하기 힘들다

## 참고한 글

- https://facebook.github.io/flux/docs/in-depth-overview/
- https://www.javatpoint.com/react-flux-vs-mvc

export const meta = PostUtil.createPostMeta({
    index: 55,
    title: "React의 상태관리 (1) - Flux 패턴",
    description: "React는 왜 Flux 패턴을 사용할까?",
    category: '',
    series: "",
    tags: ["React", "flux"],
    postedAt: '2022. 11. 09.',
});
export default ({children}) => <PostLayout meta={meta}>{children}</PostLayout>
