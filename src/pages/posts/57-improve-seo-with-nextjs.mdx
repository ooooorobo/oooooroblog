import PostUtil from "../../utils/postUtil"; import PostLayout from "../../components/post/PostLayout"; import Caption
    from "../../components/mdx/Caption"; import Link from "../../components/mdx/Link";

# SEO?

SEO(Search Engine Optimization, 검색엔진 최적화)는 검색 엔진이 사이트의 글을 잘 이해하고 가져갈 수 있도록 최적화하는 것을 말한다. SEO가 잘 되어 있어야 검색 엔진에서 내 글이 상단에 잘 노출된다.

대표적인 검색 엔진이 구글이다. 어떤 키워드를 검색하면, 구글은 그 키워드에 맞는 페이지를 보여줘야 한다. 이때 보여줄 페이지를 찾기 위해 구글은 웹 크롤러를 사용해 웹의 사이트들을 탐색한다. 크롤러가 찾은 사이트는 구글의 검색 색인에 등록하고, 등록된 사이트들이 키워드에 대한 검색 결과로 표시된다.

결론적으로, 검색에 잘 걸리기 위해선 크롤러가 사이트의 글을 잘 긁어갈 수 있는 환경을 만들어 줘야 한다.

## 웹이 크롤링되는 방식

정확하진 않지만 체감상 Search Console에 등록하는 것보다 백링크가 더 중요한 것 같다. 똑같이 메타 태그 처리를 해 준 상태에서, 사이트맵을 제출했지만 다른 사이트에서 링크되지 않는 사이트는 아무리 기다려도 크롤링해주지 않고, 페이스북 & 인스타그램에서 꾸준히 링크를 걸어준 사이트는 사이트맵을 만들지도 않았는데 검색에 잘만 걸렸다 😇


# 페이지에 적절한 메타 태그 달아주기

크롤러가 편하게 데이터를 긁어갈 수 있도록 약속된 위치에 데이터를 놓아주자.

[Next-SEO](https://github.com/garmeeh/next-seo) 라이브러리를 사용하면 페이지마다 편하게 메타 태그를 달아줄 수 있다.

페이지 컴포넌트에 `NextSeo` 컴포넌트를 추가하고, 원하는 값을 넣어주면 된다. 이 블로그의 포스트 페이지에는 아래와 같은 코드가 들어 있다.

```tsx
      <NextSeo
        title={meta.title}
        description={meta.description}
        canonical={`https://www.oooooroblog.com${router.pathname}`}
        openGraph={{
          type: "website",
          title: meta.title,
          description: meta.description,
          url: `https://www.oooooroblog.com${router.pathname}`,
        }}
      />
```

혹은 html 페이지의 head 태그 안에 메타 태그를 넣어 줘도 된다.

## The Open Graph protocol

[오픈 그래프 프로토콜](https://ogp.me/)은 웹 페이지 컨텐츠를 표시하는 방법을 나타내기 위한 프로토콜이다. 웹 페이지에서 제공하는 제목, 설명, 미리보기 이미지 등을 메타 데이터로 표현할 수 있다.

## 태그가 제대로 달렸을까?

[페이스북 공유 디버거](https://developers.facebook.com/tools/debug)에 페이지 링크를 넣어보면 메타 태그가 잘 들어갔는지 쉽게 확인할 수 있다.

![페이스북 공유 디버거](/image/57/img_4.png)

<Caption>페북 로그인을 해야 쓸 수 있는데, 얼마 전에 페북을 탈퇴해서... 퍼왔다. <Link href={'https://developers.facebook.com/docs/sharing/webmasters/'}>퍼온 출처</Link> </Caption>

# Next.js로 편하게 사이트맵 만들기

사이트맵은 아래와 같은 형식으로 생성되어야 한다.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
   <url>
      <loc>http://www.example.com/</loc>
      <lastmod>2005-01-01</lastmod>
      <changefreq>monthly</changefreq>
      <priority>0.8</priority>
   </url>
</urlset>
```

url은 여러개일 수 있다. 더 자세한 포맷은 [여기](https://www.sitemaps.org/protocol.html)에서 확인할 수 있다.

<br/>

Next.js에서 제공하는 `getServerSideProps`를 활용하면 편하게 사이트맵을 만들 수 있다. 페이지가 추가되거나 삭제될 때마다 사이트맵을 수정하지 않아도 돼서 정말 편하다.

자세한 방법은 [Next.js 공식 문서](https://nextjs.org/learn/seo/crawling-and-indexing/xml-sitemaps)에 잘 설명되어 있다. 아래는 해당 블로그에서 사용하고 있는 사이트맵 생성 코드이다.

```tsx
// pages/sitemap.xml.ts (pages 하위에 있지만 jsx 문법을 사용하지 않음)
import { GetServerSidePropsContext } from "next";
import PostService from "@src/service/postService";

const genDate = new Date().toISOString();
const domain = "https://www.oooooroblog.com";

function makeUrlNode(url: string, lastMod = genDate) {
  return `
        <url>
          <loc>${url}</loc>
          <lastmod>${lastMod}</lastmod>
        </url>`;
}

function generateSiteMap(posts: string[]) {
  return `<?xml version="1.0" encoding="UTF-8"?>
            <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
                <url>
                    <loc>${domain}</loc>
                    <lastmod>${genDate}</lastmod>
                </url>
                <url>
                    <loc>${domain}/about</loc>
                    <lastmod>${genDate}</lastmod>
                </url>
                ${posts
                  .map((page) => {
                    const path = page
                      .replace(".mdx", "")
                      .replace(".tsx", "")
                      .replace("index", "");
                    return makeUrlNode(`${domain}/posts/${path}`);
                  })
                  .join("")}
            </urlset>
`;
}

export default function SiteMap() {
  //
}

export async function getServerSideProps({ res }: GetServerSidePropsContext) {
  // 블로그 포스트들의 하위 주소를 가져온다
  const slugs = await PostService.instance.getAllPostSlugs();
  // xml 형식의 sitemap string을 만든다
  const sitemap = generateSiteMap(slugs);

  // 만든 sitemap을 xml 형식으로 내보낸다
  res.setHeader("Content-Type", "text/xml");
  res.write(sitemap);
  res.end();

  return { props: {} };
}

```

> 참고하기: [이 글](https://medium.com/volla-live/next-js%EB%A5%BC-%EC%9C%84%ED%95%9C-sitemap-generator-%EB%A7%8C%EB%93%A4%EA%B8%B0-10fc917d307e)에서는 getServerSideProps / getStaticSideProps를 사용하지 않고 사이트맵 xml 파일을 생성하는 방법을 소개하고 있다.

## Google Search Console 등록하기

[구글 서치 콘솔](https://search.google.com/search-console/welcome?hl=ko)에서 도메인을 등록하고, 서치 콘솔이 요구하는대로 인증 절차를 거친다.

구글 서치 콘솔의 경우 DNS 레코드를 통해서 도메인 인증을 하고 있다. 사용하고 있는 도메인의 호스팅 서비스에서 DNS 네임서버 설정을 해도 되고, Vercel 같은 배포 플랫폼을 사용한다면 여기에서 DNS 설정을 해도 된다.

네이버에도 [네이버 서치 어드바이저](https://searchadvisor.naver.com/)가 있다. 네이버에서는 서치 어드바이저에서 제공하는 html 파일을 업로드하는 방식으로 프로젝트 인증을 하고 있다. Next.js의 경우 public 폴더 바로 하위에 다운받은 html 파일을 업로드하고 배포하면 된다.

인증을 마쳤다면 각 서비스에 프로젝트의 사이트맵 링크를 제출하면 된다.

그리고 언젠가 크롤러가 내 사이트를 방문해 줄 때까지 하염없이 기다리면 된다... 백링크가 없는 신생 사이트의 경우 운이 나쁘면 3달 넘게 기다려야 할 수도 있다.


# 참고한 글

- [https://www.sitemaps.org/protocol.html](https://www.sitemaps.org/protocol.html)
- [https://ogp.me/](https://ogp.me/)
- [https://nextjs.org/learn/seo/crawling-and-indexing/xml-sitemaps](https://nextjs.org/learn/seo/crawling-and-indexing/xml-sitemaps)
- [https://developers.google.com/search/docs/fundamentals/seo-starter-guide](https://developers.google.com/search/docs/fundamentals/seo-starter-guide)
- [https://developers.google.com/search/docs/fundamentals/how-search-works](https://developers.google.com/search/docs/fundamentals/how-search-works)

export const meta = PostUtil.createPostMeta({
    index: 57,
    title: "Next.js 프로젝트 SEO 개선하기",
    description: "구글 검색에 내 블로그 글이 걸리게 해보자",
    category: '',
    series: "",
    tags: ["SEO", "Next.js"],
    postedAt: '2022. 11. 27.',
});
export default ({children}) => <PostLayout meta={meta}>{children}</PostLayout>
